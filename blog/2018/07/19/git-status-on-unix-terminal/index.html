<!DOCTYPE html>
<html lang="en-us">
<head>
    <title>Git status on Unix terminal - Self dot send (Computing Blog)</title>
    <meta charset="utf-8" />
    <meta name="author" content="Pankaj Doharey" />
        <meta name="description" content="Get git status on unix terminal (PS1)." />
        <meta name="keywords" content="git status, terminal" />
    <link rel="stylesheet" href="/media/css/style.css">
    <link rel="stylesheet" href="/media/css/highlight.css">
    <style type="text/css"></style>
</head>

  <body class="container">
    <nav class="main-nav">
        <a href="/blog">Blog</a>
        <a href="/tags">Tag</a>
        <a href="/about/">About</a>
        <a class="cta" href="https://github.com/metacritical">GitHub</a>
    </nav>

<div>
    <section id="wrapper">
        <article class="post">
            <header>
                    <h1>Git status on Unix terminal</h1>
            </header>
            <br />
            <section id="post-body">
                <p>
It is often required to get git stats on terminal PS1, most solutions are based 
aound bash can be slow sometimes or if you are like me who programmed something 
in ruby also turned out to be slow. We can make things faster by porting such 
scripts to golang. one such solution can be this :
</p>

<div class="org-src-container">
<pre class="src src-go">
<span style="color: #ff0066;">package</span> main

<span style="color: #ff0066;">import</span> <span style="color: #ab7eff;">(</span>
        <span style="color: #E6DB74;">"os"</span>
        <span style="color: #E6DB74;">"fmt"</span>
        <span style="color: #E6DB74;">"regexp"</span>
        <span style="color: #E6DB74;">"os/exec"</span>
        <span style="color: #6A6D70;">//</span><span style="color: #6A6D70;">"strings"</span>
<span style="color: #ab7eff;">)</span>

<span style="color: #ff0066;">var</span> getSymbol = <span style="color: #ff0066;">map</span><span style="color: #ab7eff;">[</span><span style="color: #06d8ff;">string</span><span style="color: #ab7eff;">]</span><span style="color: #06d8ff;">string</span><span style="color: #ab7eff;">{</span>
        <span style="color: #E6DB74;">"untracked"</span>:<span style="color: #E6DB74;">"\xe2\x9a\xa0\xef\xb8\x8f"</span>,
        <span style="color: #E6DB74;">"alliswell"</span>:<span style="color: #E6DB74;">"\xe2\x98\xaf\xef\xb8\x8f"</span>,
        <span style="color: #E6DB74;">"hazard"</span>:<span style="color: #E6DB74;">"\xe2\x98\xa2\xef\xb8\x8f"</span>,
        <span style="color: #E6DB74;">"deleted"</span>:<span style="color: #E6DB74;">"\xE2\x9D\x8C"</span>,
        <span style="color: #E6DB74;">"smiley"</span>:<span style="color: #E6DB74;">"\xf0\x9f\x99\x82"</span>,
        <span style="color: #E6DB74;">"noentry"</span>:<span style="color: #E6DB74;">"\xe2\x9b\x94\xef\xb8\x8f"</span>,
        <span style="color: #E6DB74;">"repoahead"</span>:<span style="color: #E6DB74;">"\xE2\x98\x9D"</span>,
        <span style="color: #E6DB74;">"novc"</span>:<span style="color: #E6DB74;">"\xf0\x9f\x9a\xab\x0a"</span>,
        <span style="color: #E6DB74;">"changes"</span>:<span style="color: #E6DB74;">"\xe2\x99\xbb\xef\xb8\x8f"</span>,
<span style="color: #ab7eff;">}</span>

<span style="color: #ff0066;">func</span> <span style="color: #63de5d;">execCommand</span><span style="color: #ab7eff;">(</span>command <span style="color: #06d8ff;">string</span><span style="color: #ab7eff;">)</span> <span style="color: #06d8ff;">string</span><span style="color: #ab7eff;">{</span>
        gitExec := exec.<span style="color: #63de5d;">Command</span><span style="color: #06d8ff;">(</span><span style="color: #E6DB74;">"git"</span>, command<span style="color: #06d8ff;">)</span>
        outPut, err  := gitExec.<span style="color: #63de5d;">Output</span><span style="color: #06d8ff;">()</span>
        <span style="color: #ff0066;">if</span> err != <span style="color: #ab7eff;">nil</span> <span style="color: #06d8ff;">{</span>
                <span style="color: #ff0066;">return</span> err.<span style="color: #63de5d;">Error</span><span style="color: #63de5d;">()</span>
        <span style="color: #06d8ff;">}</span>
        <span style="color: #ff0066;">return</span> <span style="color: #63de5d;">string</span><span style="color: #06d8ff;">(</span>outPut<span style="color: #06d8ff;">)</span>
<span style="color: #ab7eff;">}</span>

<span style="color: #ff0066;">func</span> <span style="color: #63de5d;">processStatus</span><span style="color: #ab7eff;">(</span>status <span style="color: #06d8ff;">string</span><span style="color: #ab7eff;">)</span> <span style="color: #06d8ff;">string</span><span style="color: #ab7eff;">{</span>
        <span style="color: #ff0066;">var</span> noVC = regexp.<span style="color: #63de5d;">MustCompile</span><span style="color: #06d8ff;">(</span><span style="color: #E6DB74;">"Not a git repository"</span><span style="color: #06d8ff;">)</span>
        <span style="color: #ff0066;">var</span> unTracked = regexp.<span style="color: #63de5d;">MustCompile</span><span style="color: #06d8ff;">(</span><span style="color: #E6DB74;">"Untracked files"</span><span style="color: #06d8ff;">)</span>
        <span style="color: #ff0066;">var</span> notStaged = regexp.<span style="color: #63de5d;">MustCompile</span><span style="color: #06d8ff;">(</span><span style="color: #E6DB74;">"Changes not staged for commit"</span><span style="color: #06d8ff;">)</span>
        <span style="color: #ff0066;">var</span> exitCode = regexp.<span style="color: #63de5d;">MustCompile</span><span style="color: #06d8ff;">(</span><span style="color: #E6DB74;">"exit status 128"</span><span style="color: #06d8ff;">)</span>

        <span style="color: #ff0066;">switch</span> <span style="color: #06d8ff;">{</span>
                <span style="color: #ff0066;">case</span> noVC.<span style="color: #63de5d;">MatchString</span><span style="color: #63de5d;">(</span>status<span style="color: #63de5d;">)</span> :
                <span style="color: #ff0066;">return</span> getSymbol<span style="color: #63de5d;">[</span><span style="color: #E6DB74;">"novc"</span><span style="color: #63de5d;">]</span>
                <span style="color: #ff0066;">case</span> unTracked.<span style="color: #63de5d;">MatchString</span><span style="color: #63de5d;">(</span>status<span style="color: #63de5d;">)</span>:
                <span style="color: #ff0066;">return</span> getSymbol<span style="color: #63de5d;">[</span><span style="color: #E6DB74;">"untracked"</span><span style="color: #63de5d;">]</span>
                <span style="color: #ff0066;">case</span> notStaged.<span style="color: #63de5d;">MatchString</span><span style="color: #63de5d;">(</span>status<span style="color: #63de5d;">)</span> :
                <span style="color: #ff0066;">return</span> getSymbol<span style="color: #63de5d;">[</span><span style="color: #E6DB74;">"changes"</span><span style="color: #63de5d;">]</span>
                <span style="color: #ff0066;">case</span> exitCode.<span style="color: #63de5d;">MatchString</span><span style="color: #63de5d;">(</span>status<span style="color: #63de5d;">)</span>:
                <span style="color: #ff0066;">return</span> getSymbol<span style="color: #63de5d;">[</span><span style="color: #E6DB74;">"noentry"</span><span style="color: #63de5d;">]</span>
                <span style="color: #ff0066;">default</span>:
                <span style="color: #ff0066;">return</span> getSymbol<span style="color: #63de5d;">[</span><span style="color: #E6DB74;">"alliswell"</span><span style="color: #63de5d;">]</span>
        <span style="color: #06d8ff;">}</span>

<span style="color: #ab7eff;">}</span>

<span style="color: #ff0066;">func</span> <span style="color: #63de5d;">processBranch</span><span style="color: #ab7eff;">(</span>branchdata <span style="color: #06d8ff;">string</span><span style="color: #ab7eff;">)</span> <span style="color: #06d8ff;">string</span><span style="color: #ab7eff;">{</span>
        <span style="color: #ff0066;">var</span> branchMatch = regexp.<span style="color: #63de5d;">MustCompile</span><span style="color: #06d8ff;">(</span><span style="color: #E6DB74;">`[(^\*)].+`</span><span style="color: #06d8ff;">)</span>
        match := branchMatch.<span style="color: #63de5d;">FindAllString</span><span style="color: #06d8ff;">(</span>branchdata, 1<span style="color: #06d8ff;">)</span>

        <span style="color: #ff0066;">if</span> match != <span style="color: #ab7eff;">nil</span><span style="color: #06d8ff;">{</span>
                <span style="color: #ff0066;">return</span> <span style="color: #E6DB74;">"\033[38;5;112m"</span>+ match<span style="color: #63de5d;">[</span>0<span style="color: #63de5d;">][</span>1:<span style="color: #63de5d;">]</span> + <span style="color: #E6DB74;">"\033[0m\n"</span>
        <span style="color: #06d8ff;">}</span>

        <span style="color: #ff0066;">return</span> getSymbol<span style="color: #06d8ff;">[</span><span style="color: #E6DB74;">"novc"</span><span style="color: #06d8ff;">]</span>
<span style="color: #ab7eff;">}</span>

<span style="color: #ff0066;">func</span> <span style="color: #63de5d;">gitBranch</span><span style="color: #ab7eff;">()</span> <span style="color: #06d8ff;">string</span><span style="color: #ab7eff;">{</span>
        <span style="color: #ff0066;">return</span> <span style="color: #63de5d;">processBranch</span><span style="color: #06d8ff;">(</span><span style="color: #63de5d;">execCommand</span><span style="color: #63de5d;">(</span><span style="color: #E6DB74;">"branch"</span><span style="color: #63de5d;">)</span><span style="color: #06d8ff;">)</span>
<span style="color: #ab7eff;">}</span>

<span style="color: #ff0066;">func</span> <span style="color: #63de5d;">gitStatus</span><span style="color: #ab7eff;">()</span> <span style="color: #06d8ff;">string</span><span style="color: #ab7eff;">{</span>
        <span style="color: #ff0066;">return</span> <span style="color: #63de5d;">processStatus</span><span style="color: #06d8ff;">(</span><span style="color: #63de5d;">execCommand</span><span style="color: #63de5d;">(</span><span style="color: #E6DB74;">"status"</span><span style="color: #63de5d;">)</span><span style="color: #06d8ff;">)</span>
<span style="color: #ab7eff;">}</span>

<span style="color: #ff0066;">func</span> <span style="color: #63de5d;">main</span><span style="color: #ab7eff;">(){</span>
        <span style="color: #ff0066;">var</span> args <span style="color: #06d8ff;">[]</span><span style="color: #06d8ff;">string</span> = os.Args<span style="color: #06d8ff;">[</span>0:<span style="color: #06d8ff;">]</span>

        <span style="color: #ff0066;">if</span> <span style="color: #ff0066;">len</span><span style="color: #06d8ff;">(</span>args<span style="color: #06d8ff;">)</span> &gt; 1 <span style="color: #06d8ff;">{</span>
                <span style="color: #ff0066;">switch</span> args<span style="color: #63de5d;">[</span>1<span style="color: #63de5d;">]{</span>
                <span style="color: #ff0066;">case</span> <span style="color: #E6DB74;">"b"</span>, <span style="color: #E6DB74;">"branch"</span>:
                        fmt.<span style="color: #63de5d;">Print</span><span style="color: #ffac4a;">(</span><span style="color: #63de5d;">gitBranch</span><span style="color: #ff0066;">()</span><span style="color: #ffac4a;">)</span>
                <span style="color: #ff0066;">case</span> <span style="color: #E6DB74;">"s"</span>, <span style="color: #E6DB74;">"status"</span>:
                        fmt.<span style="color: #63de5d;">Print</span><span style="color: #ffac4a;">(</span><span style="color: #63de5d;">gitStatus</span><span style="color: #ff0066;">()</span><span style="color: #ffac4a;">)</span>
                <span style="color: #ff0066;">case</span> <span style="color: #E6DB74;">"p"</span>, <span style="color: #E6DB74;">"prompt"</span>:
                        fmt.<span style="color: #63de5d;">Print</span><span style="color: #ffac4a;">(</span><span style="color: #63de5d;">gitStatus</span><span style="color: #ff0066;">()</span>, <span style="color: #E6DB74;">" "</span>, <span style="color: #63de5d;">gitBranch</span><span style="color: #ff0066;">()</span>, <span style="color: #E6DB74;">"&gt;&gt;"</span><span style="color: #ffac4a;">)</span>
                <span style="color: #ff0066;">default</span>:
                        fmt.<span style="color: #63de5d;">Print</span><span style="color: #ffac4a;">(</span><span style="color: #63de5d;">execCommand</span><span style="color: #ff0066;">(</span>args<span style="color: #FF61FF;">[</span>1<span style="color: #FF61FF;">]</span><span style="color: #ff0066;">)</span><span style="color: #ffac4a;">)</span>
                <span style="color: #63de5d;">}</span>
        <span style="color: #06d8ff;">}</span><span style="color: #ff0066;">else</span><span style="color: #06d8ff;">{</span>
                fmt.<span style="color: #63de5d;">Println</span><span style="color: #63de5d;">(</span><span style="color: #E6DB74;">"Command Not found"</span><span style="color: #63de5d;">)</span>
        <span style="color: #06d8ff;">}</span>
<span style="color: #ab7eff;">}</span>
</pre>
</div>

            </section>
    </section>
</div>

    <div>
    <section id="wrapper">
      <div class="post-meta">
        <span title="post date" class="post-info">2018-07-19</span>
        <span title="tags" class="post-info"><a href="/tags/unix/">unix</a>, <a href="/tags/terminal/">terminal</a>, <a href="/tags/git/">git</a>, <a href="/tags/ps1/">ps1</a></span>
      </div>
      <br />
      <br />
      <section>
        <h1>Comments</h1>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
          //var disqus_developer = 1;
          var disqus_identifier = "/blog/2018/07/19/git-status-on-unix-terminal";
          var disqus_url = "http://selfdotsend.com/blog/2018/07/19/git-status-on-unix-terminal";
          var disqus_shortname = 'selfdotsend';
          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </section>
      <script src="http://code.jquery.com/jquery-latest.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.js"></script>
      <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script src="/media/js/main.js"></script>
      <div align="center">
      <footer id="footer">
        <p class="small">
          Copyright &copy; 2012 - <span id="footerYear"></span> <a href="mailto:pankajdoharey &lt;at&gt; Pankajs-MacBook-Air &lt;dot&gt; local">Pankaj Doharey</a>
          &nbsp;&nbsp;-&nbsp;&nbsp;
          Powered by <a href="https://github.com/kelvinh/org-page" target="_blank">org-page</a>
          <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
        <br />
      </footer>
      </div>
      </section>
    </div>

  </body>
</html>
