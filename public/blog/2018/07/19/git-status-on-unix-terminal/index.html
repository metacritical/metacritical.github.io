<!DOCTYPE html>
<html lang="en-us">
<head>
  <title>Git status on Unix terminal - Self dot send (Computing Blog)</title>
  <meta charset="utf-8" />
  <meta name="author" content="Pankaj Doharey" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Get git status on unix terminal (PS1)." />
  <meta name="keywords" content="git status, terminal" />
  <link rel="icon" href="/media/img/favicon.ico" type="image/x-icon" />
  <link rel="stylesheet" href="/media/css/style.css" type="text/css">
  <link rel="stylesheet" href="/media/css/prettify.css" type="text/css">
  <link rel="stylesheet" href="/media/css/syntax-highlight.css" type="text/css">
  <link rel="stylesheet" href="/media/css/highlight.css" type="text/css">
  <link rel="stylesheet" href="/media/css/theme-medium.css?v=1770771501" type="text/css">
  <link rel="stylesheet" href="/media/css/code-theme-monokai-pro.css?v=1770771803" type="text/css">
</head>

  <body class="container">
<nav class="main-nav medium-nav">
  <div class="nav-left site-brand">
    <a class="brand-logo-link" href="/"><img class="brand-logo" src="/media/images/logo.png" alt="Self dot send"></a>
    <div class="brand-copy">
      <a class="brand-title" href="/">Self dot send (Computing Blog)</a>
      <div class="brand-tagline">Message passing is just a procedure call.</div>
    </div>
  </div>
  <div class="nav-right">
    <a href="/">Blog</a>
    <a href="/archive/">Archive</a>
    <a href="/tags/">Tag</a>
    <a href="/about/">About</a>
    <a href="/nano-chat/">Nano Chat</a>
    <button id="site-search-open" class="search-btn" type="button" aria-haspopup="dialog" aria-controls="site-search-overlay">
      <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true">
        <circle cx="11" cy="11" r="7" fill="none" stroke="currentColor" stroke-width="2"></circle>
        <line x1="16.65" y1="16.65" x2="21" y2="21" stroke="currentColor" stroke-width="2" stroke-linecap="round"></line>
      </svg>
      <span>Search</span>
      <kbd>/</kbd>
    </button>
    <button id="theme-switch" class="theme-switch" type="button">Theme: Medium</button>
    <a class="cta" href="https://github.com/metacritical">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 499.36" focusable="false"><title>GitHub</title><path d="M256 0C114.64 0 0 114.61 0 256c0 113.09 73.34 209 175.08 242.9 12.8 2.35 17.47-5.56 17.47-12.34 0-6.08-.22-22.18-.35-43.54-71.2 15.49-86.2-34.34-86.2-34.34-11.64-29.57-28.42-37.45-28.42-37.45-23.27-15.84 1.73-15.55 1.73-15.55 25.69 1.81 39.21 26.38 39.21 26.38 22.84 39.12 59.92 27.82 74.5 21.27 2.33-16.54 8.94-27.82 16.25-34.22-56.84-6.43-116.6-28.43-116.6-126.49 0-27.95 10-50.8 26.35-68.69-2.63-6.48-11.42-32.5 2.51-67.75 0 0 21.49-6.88 70.4 26.24a242.65 242.65 0 0 1 128.18 0c48.87-33.13 70.33-26.24 70.33-26.24 14 35.25 5.18 61.27 2.55 67.75 16.41 17.9 26.31 40.75 26.31 68.69 0 98.35-59.85 120-116.88 126.32 9.19 7.9 17.38 23.53 17.38 47.41 0 34.22-.31 61.83-.31 70.23 0 6.85 4.61 14.81 17.6 12.31C438.72 464.97 512 369.08 512 256.02 512 114.62 397.37 0 256 0z" fill="currentColor" fill-rule="evenodd"></path></svg>
    </a>
  </div>
</nav>
<div id="site-search-overlay" class="site-search-overlay" hidden>
  <div class="site-search-panel" role="dialog" aria-modal="true" aria-labelledby="site-search-title">
    <div class="site-search-top">
      <h2 id="site-search-title">Search posts</h2>
      <button id="site-search-close" class="site-search-close" type="button" aria-label="Close search">Close</button>
    </div>
    <input id="site-search-input" class="site-search-input" type="search" placeholder="Type to search posts..." autocomplete="off" />
    <p class="site-search-hint">Use <kbd>/</kbd> to open, <kbd>‚Üë</kbd><kbd>‚Üì</kbd> to navigate, <kbd>Enter</kbd> to open.</p>
    <ul id="site-search-results" class="site-search-results"></ul>
  </div>
</div>

<section id="wrapper" class="post-page">
  <div class="post">
  <h1 class="title">Git status on Unix terminal</h1>
  <aside class="story-rail" aria-label="Story actions">
    <button class="story-clap-btn" type="button" aria-label="Clap for this story">üëè</button>
    <span class="story-clap-count">0</span>
    <div class="story-share-label">Share</div>
    <a class="story-share-link story-share-x" href="#" target="_blank" rel="noopener" aria-label="Share on X">ùïè</a>
    <a class="story-share-link story-share-fb" href="#" target="_blank" rel="noopener" aria-label="Share on Facebook">f</a>
    <a class="story-share-link story-share-ln" href="#" target="_blank" rel="noopener" aria-label="Share on LinkedIn">in</a>
  </aside>
  <div class="post-author-row">
    <img class="post-author-avatar" src="/media/images/avatar.jpg" alt="Pankaj Doharey">
    <div class="post-author-meta">
      <span class="post-author-name">Pankaj Doharey</span>
      <span class="post-author-date"></span>
    </div>
  </div>
  <p>
It is often required to get git stats on terminal PS1, most solutions are based 
aound bash can be slow sometimes or if you are like me who programmed something 
in ruby also turned out to be slow. We can make things faster by porting such 
scripts to golang. one such solution can be this :
</p>

<div class="org-src-container">
<pre class="src src-go">
<span class="org-keyword">package</span> main

<span class="org-keyword">import</span> (
        <span class="org-string">"os"</span>
        <span class="org-string">"fmt"</span>
        <span class="org-string">"regexp"</span>
        <span class="org-string">"os/exec"</span>
        <span class="org-comment">//"strings"</span>
)

<span class="org-keyword">var</span> getSymbol = <span class="org-keyword">map</span>[string]string{
        <span class="org-string">"untracked"</span>:<span class="org-string">"\xe2\x9a\xa0\xef\xb8\x8f"</span>,
        <span class="org-string">"alliswell"</span>:<span class="org-string">"\xe2\x98\xaf\xef\xb8\x8f"</span>,
        <span class="org-string">"hazard"</span>:<span class="org-string">"\xe2\x98\xa2\xef\xb8\x8f"</span>,
        <span class="org-string">"deleted"</span>:<span class="org-string">"\xE2\x9D\x8C"</span>,
        <span class="org-string">"smiley"</span>:<span class="org-string">"\xf0\x9f\x99\x82"</span>,
        <span class="org-string">"noentry"</span>:<span class="org-string">"\xe2\x9b\x94\xef\xb8\x8f"</span>,
        <span class="org-string">"repoahead"</span>:<span class="org-string">"\xE2\x98\x9D"</span>,
        <span class="org-string">"novc"</span>:<span class="org-string">"\xf0\x9f\x9a\xab\x0a"</span>,
        <span class="org-string">"changes"</span>:<span class="org-string">"\xe2\x99\xbb\xef\xb8\x8f"</span>,
}

<span class="org-keyword">func</span> execCommand(command string) string{
        gitExec := exec.Command(<span class="org-string">"git"</span>, command)
        outPut, err  := gitExec.Output()
        <span class="org-keyword">if</span> err != nil {
                <span class="org-keyword">return</span> err.Error()
        }
        <span class="org-keyword">return</span> string(outPut)
}

<span class="org-keyword">func</span> processStatus(status string) string{
        <span class="org-keyword">var</span> noVC = regexp.MustCompile(<span class="org-string">"Not a git repository"</span>)
        <span class="org-keyword">var</span> unTracked = regexp.MustCompile(<span class="org-string">"Untracked files"</span>)
        <span class="org-keyword">var</span> notStaged = regexp.MustCompile(<span class="org-string">"Changes not staged for commit"</span>)
        <span class="org-keyword">var</span> exitCode = regexp.MustCompile(<span class="org-string">"exit status 128"</span>)

        <span class="org-keyword">switch</span> {
                <span class="org-keyword">case</span> noVC.MatchString(status) :
                <span class="org-keyword">return</span> getSymbol[<span class="org-string">"novc"</span>]
                <span class="org-keyword">case</span> unTracked.MatchString(status):
                <span class="org-keyword">return</span> getSymbol[<span class="org-string">"untracked"</span>]
                <span class="org-keyword">case</span> notStaged.MatchString(status) :
                <span class="org-keyword">return</span> getSymbol[<span class="org-string">"changes"</span>]
                <span class="org-keyword">case</span> exitCode.MatchString(status):
                <span class="org-keyword">return</span> getSymbol[<span class="org-string">"noentry"</span>]
                <span class="org-keyword">default</span>:
                <span class="org-keyword">return</span> getSymbol[<span class="org-string">"alliswell"</span>]
        }

}

<span class="org-keyword">func</span> processBranch(branchdata string) string{
        <span class="org-keyword">var</span> branchMatch = regexp.MustCompile(<span class="org-string">`[(^\*)].+`</span>)
        match := branchMatch.FindAllString(branchdata, <span class="org-constant">1</span>)

        <span class="org-keyword">if</span> match != nil{
                <span class="org-keyword">return</span> <span class="org-string">"\033[38;5;112m"</span>+ match[<span class="org-constant">0</span>][<span class="org-constant">1</span>:] + <span class="org-string">"\033[0m\n"</span>
        }

        <span class="org-keyword">return</span> getSymbol[<span class="org-string">"novc"</span>]
}

<span class="org-keyword">func</span> gitBranch() string{
        <span class="org-keyword">return</span> processBranch(execCommand(<span class="org-string">"branch"</span>))
}

<span class="org-keyword">func</span> gitStatus() string{
        <span class="org-keyword">return</span> processStatus(execCommand(<span class="org-string">"status"</span>))
}

<span class="org-keyword">func</span> main(){
        <span class="org-keyword">var</span> args []string = os.Args[<span class="org-constant">0</span>:]

        <span class="org-keyword">if</span> len(args) &gt; <span class="org-constant">1</span> {
                <span class="org-keyword">switch</span> args[<span class="org-constant">1</span>]{
                <span class="org-keyword">case</span> <span class="org-string">"b"</span>, <span class="org-string">"branch"</span>:
                        fmt.Print(gitBranch())
                <span class="org-keyword">case</span> <span class="org-string">"s"</span>, <span class="org-string">"status"</span>:
                        fmt.Print(gitStatus())
                <span class="org-keyword">case</span> <span class="org-string">"p"</span>, <span class="org-string">"prompt"</span>:
                        fmt.Print(gitStatus(), <span class="org-string">" "</span>, gitBranch(), <span class="org-string">"&gt;&gt;"</span>)
                <span class="org-keyword">default</span>:
                        fmt.Print(execCommand(args[<span class="org-constant">1</span>]))
                }
        }<span class="org-keyword">else</span>{
                fmt.Println(<span class="org-string">"Command Not found"</span>)
        }
}
</pre>
</div>

<p>
You can download this by executing the following command on your terminal:
</p>

<div class="org-src-container">
<pre class="src src-bash">$ wget <span class="org-string">'https://gist.githubusercontent.com/metacritical/af275b7a6a92f7ade6dc5014ccfea247/raw/b0a4d3f8cc1e0e0d360acc50eb71fe0fd225e52a/gits.go'</span>
</pre>
</div>

<p>
And then compiling it with go.
</p>

<div class="org-src-container">
<pre class="src src-bash">go build gits.go -o gits
</pre>
</div>

<p>
Once that is done you should put it somewhere and include it in the PATH.
Also the PS1 should be modified like this.
</p>

<div class="org-src-container">
<pre class="src src-bash"><span class="org-variable-name">PS1</span>=<span class="org-string">"\[\033[38;5;202m\]$(</span><span class="org-sh-quoted-exec">pwd</span><span class="org-string">)\n\[\033[38;5;135m\]\@ $(</span><span class="org-sh-quoted-exec">gits prompt</span><span class="org-string">)"</span>
</pre>
</div>

<p>
This would yield a prompt like this:
</p>


<div id="org5e7b905" class="figure">
<p><img src="/assets/blog/2018/07/19/git-status-on-unix-terminal/gits_normal.png" alt="gits_normal.png" />
</p>
</div>

<p>
If git files are unstaged on the current path then it may look like this:
</p>


<div id="org2ef6a25" class="figure">
<p><img src="/assets/blog/2018/07/19/git-status-on-unix-terminal/gits_unstaged.png" alt="gits_unstaged.png" />
</p>
</div>

<p>
Thats it folks! Happy hacking.
</p>

  </div>
</section>

<div>
  <section id="wrapper" class="post-meta-wrap">
    <div class="post-meta">
      <span title="post date" class="post-info post-info--date">2018-07-19</span>
      <span title="author" class="post-info post-info--author">Pankaj Doharey</span>
    </div>
  </section>
  <section id="comments" class="comments">
    <h1>Responses</h1>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_identifier = "/blog/2018/07/19/git-status-on-unix-terminal";
      var disqus_url = "https://selfdotsend.com/blog/2018/07/19/git-status-on-unix-terminal";
      var disqus_shortname = "SelfDotSend";
      (function() {
        var dsq = document.createElement("script");
        dsq.type = "text/javascript";
        dsq.async = true;
        dsq.src = "https://" + disqus_shortname + ".disqus.com/embed.js";
        (document.head || document.body).appendChild(dsq);
      })();
    </script>
  </section>
  <script src="/media/js/prettify.js"></script>
  <script src="/media/js/main.js"></script>
  <script src="/media/js/theme-switcher.js"></script>
  <script src="/media/js/search.js"></script>
  <script src="/media/js/nano-chat.js"></script>
  <section id="wrapper">
    <br />
    <br />
    <div align="center">
      <footer id="footer">
        <p class="small">
          Copyright &copy; 2012 - <span id="footerYear"></span> <a href="mailto:pankajdoharey &lt;at&gt; Pankajs-MacBook-Air &lt;dot&gt; local">Pankaj Doharey</a>
          &nbsp;&nbsp;-&nbsp;&nbsp;
          Powered by <a href="https://github.com/metacritical/AOG" target="_blank">AOG</a>
          <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
        <br />
      </footer>
    </div>
  </section>
</div>

  </body>
</html>
